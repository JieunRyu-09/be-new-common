<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>STOMP WebSocket 테스트</title>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        input, textarea, button { margin: 5px 0; width: 100%; }
        textarea { height: 100px; }
        #logs { white-space: pre-wrap; border: 1px solid #ccc; padding: 10px; height: 200px; overflow-y: auto; background: #f9f9f9; }
        .subscription { margin-bottom: 20px; }
    </style>
</head>
<body>

<h2>🧪 STOMP WebSocket 테스트 페이지</h2>

<label>🔗 WebSocket 주소</label>
<input type="text" id="wsUrl" value="ws://localhost:8081/ws">

<label>🔐 Authorization (예: Bearer eyJ...)</label>
<input type="text" id="authHeader" value="Bearer ">

<button onclick="connect()">Connect</button>

<hr>

<h3>📬 구독 채널</h3>
<div class="subscription">
    <label>📬 Subscribe 채널 1 (예: /topic/chat/1)</label>
    <input type="text" id="subscribeDest1" value="/topic/chat/1">
    <button onclick="subscribe(1)">Subscribe 1</button>
</div>
<div class="subscription">
    <label>📬 Subscribe 채널 2 (예: /topic/chat/2)</label>
    <input type="text" id="subscribeDest2" value="/topic/chat/2">
    <button onclick="subscribe(2)">Subscribe 2</button>
</div>
<div class="subscription">
    <label>📬 Subscribe 채널 3 (예: /topic/chat/3)</label>
    <input type="text" id="subscribeDest3" value="/topic/chat/3">
    <button onclick="subscribe(3)">Subscribe 3</button>
</div>
<div class="subscription">
    <label>📬 Subscribe 채널 4 (예: /topic/chat/4)</label>
    <input type="text" id="subscribeDest4" value="/topic/chat/4">
    <button onclick="subscribe(4)">Subscribe 4</button>
</div>

<hr>

<label>📤 Send 주소 (예: /app/chat/1)</label>
<input type="text" id="sendDest" value="/app/chat/1">

<label>✉️ 보낼 메시지 (JSON 형식)</label>
<textarea id="sendBody">{ "content": "Hello"}</textarea>

<button onclick="send()">Send</button>

<hr>

<h3>📥 수신 메시지 및 로그</h3>
<div id="logs"></div>

<script>
	let client = null;

	function log(msg) {
		const logDiv = document.getElementById("logs");
		logDiv.textContent += msg + "\n";
		logDiv.scrollTop = logDiv.scrollHeight;
	}

	function connect() {
		const wsUrl = document.getElementById("wsUrl").value;
		const token = document.getElementById("authHeader").value;

		const socket = new WebSocket(wsUrl);
		client = Stomp.over(socket);

		client.connect(
			{ Authorization: token },
			function (frame) {
				log("✅ Connected: " + frame);
			},
			function (error) {
				log("❌ Connection error: " + error);
			}
		);
	}

	// Subscribe 함수 수정 - 구독을 각각 다른 채널에 대해 처리
	function subscribe(channelNumber) {
		const destination = document.getElementById(`subscribeDest${channelNumber}`).value;
		const token = document.getElementById("authHeader").value;

		client.subscribe(
			destination,
			function (message) {
				log(`📩 채널 ${channelNumber} 수신됨: ` + message.body);
			},
			{ Authorization: token }
		);
		log(`🔔 채널 ${channelNumber} 구독 요청: ` + destination);
	}

	function send() {
		const destination = document.getElementById("sendDest").value;
		const body = document.getElementById("sendBody").value;
		const token = document.getElementById("authHeader").value;

		client.send(
			destination,
			{ Authorization: token },
			body
		);
		log("📤 보냄: " + body);
	}
</script>

</body>
</html>
